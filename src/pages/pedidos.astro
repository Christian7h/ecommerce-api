---
import Layout from '../layouts/Layout.astro';
import Orders from '../components/Orders.tsx';

const token = Astro.cookies.get("token")?.value;
if (!token) return Astro.redirect("/login");

let orders = [];
try {
  const response = await fetch("https://backend-api-nodejs-todo-api.onrender.com/api/orders", {
    headers: { "Authorization": `Bearer ${token}` },
  });
  if (!response.ok) throw new Error("Error al obtener órdenes");
  orders = await response.json();
} catch (error) {
  console.error(error);
}
---

<Layout title="Mis Órdenes">
  <Orders orders={orders} client:only="react" />
</Layout>
