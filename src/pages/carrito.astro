---
import Layout from '../layouts/Layout.astro';
import Cart from '../components/Cart.tsx';

const token = Astro.cookies.get("token")?.value;
if (!token) return Astro.redirect("/login");

let cart = { items: [] };
try {
  const response = await fetch("https://backend-api-nodejs-todo-api.onrender.com/api/cart", {
    headers: { "Authorization": `Bearer ${token}` },
  });
  if (!response.ok) throw new Error("Error al obtener carrito");
  cart = await response.json();
} catch (error) {
  console.error(error);
}

---

<Layout title="Carrito">
  <Cart cart={cart} client:only="react" />
</Layout>
